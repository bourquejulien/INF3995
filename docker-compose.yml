x-app: &default
  networks:
    - mynetwork
  
services:
  # mongo:
  #   image: mongo
  #   hostname: mongo
  #   networks:
  #     - mynetwork
  #   volumes:
  #     - mongo_data:/data/db

  client:
    <<: *default
    build:
      context: ./backend/client
      dockerfile: ./Dockerfile
      target: final
    hostname: webui
    depends_on:
      - server
    ports:
      - "5001:5001"

  server:
    <<: *default
    build:
      context: ./backend/server
      dockerfile: ./Dockerfile
      target: final
    environment:
      SIMULATION_ADDR: simulation
      IS_SIMULATION: ${IS_SIMULATION}
    hostname: backend
    privileged: true
    volumes:
      - "/dev:/dev"
    ports:
      - "5000:5000"
  
  simulator:
    <<: *default
    build:
      context: ./simulation
      dockerfile: ./Dockerfile
      args:
        - WEB_SOCKET_PORT=8001
        - SIMULATION_PORT=9854
    hostname: simulation
    depends_on:
      - server
    ports:
      - "8000:8000"
      - "8001:8001"
      - "9854:9854"


networks:
  mynetwork:

# volumes:
#   mongo_data: