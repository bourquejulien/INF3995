x-app: &default
  networks:
    - mynetwork
  
services:
  mongodb:
    image : mongo
    container_name: mongodb
    environment:
      - PUID=1000
      - PGID=1000
      - MONGO_INITDB_ROOT_USERNAME=local
      - MONGO_INITDB_ROOT_PASSWORD=lacol
    volumes:
      - mongoVolume:/data/db
    ports:
      - 5002:27017
    restart: unless-stopped

  client:
    <<: *default
    build:
      context: ./backend/client
      dockerfile: ./Dockerfile
      target: final
    hostname: webui
    depends_on:
      - server
    ports:
      - "5001:5001"

  server:
    <<: *default
    build:
      context: ./backend/server
      dockerfile: ./Dockerfile
      target: final
    environment:
      SIMULATION_ADDR: simulation
      IS_SIMULATION: ${IS_SIMULATION}
    hostname: backend
    privileged: true
    volumes:
      - "/dev:/dev"
    depends_on:
      - mongodb
    ports:
      - "5000:5000"
  
  simulator:
    <<: *default
    build:
      context: ./simulation
      dockerfile: ./Dockerfile
      args:
        - WEB_SOCKET_PORT=8001
        - SIMULATION_PORT=9854
    hostname: simulation
    depends_on:
      - server
    ports:
      - "8000:8000"
      - "8001:8001"
      - "9854:9854"

networks:
  mynetwork:

volumes:
  mongoVolume: {}
